'use strict';const a0_0x37f7f4=a0_0x5740;(function(_0x3e328a,_0x5e4758){const _0x507ba8=a0_0x5740,_0x432227=_0x3e328a();while(!![]){try{const _0x489e86=parseInt(_0x507ba8(0x1d7))/0x1*(-parseInt(_0x507ba8(0x166))/0x2)+-parseInt(_0x507ba8(0x167))/0x3+-parseInt(_0x507ba8(0x144))/0x4+-parseInt(_0x507ba8(0x174))/0x5+parseInt(_0x507ba8(0x1a3))/0x6*(-parseInt(_0x507ba8(0x15f))/0x7)+-parseInt(_0x507ba8(0x1e3))/0x8*(parseInt(_0x507ba8(0x195))/0x9)+parseInt(_0x507ba8(0x151))/0xa;if(_0x489e86===_0x5e4758)break;else _0x432227['push'](_0x432227['shift']());}catch(_0x59154f){_0x432227['push'](_0x432227['shift']());}}}(a0_0x2e62,0x60413));var __create=Object[a0_0x37f7f4(0x1a4)],__defProp=Object[a0_0x37f7f4(0x1e0)],__getOwnPropDesc=Object[a0_0x37f7f4(0x137)],__getOwnPropNames=Object[a0_0x37f7f4(0x1c6)],__getProtoOf=Object['getPrototypeOf'],__hasOwnProp=Object['prototype'][a0_0x37f7f4(0x15a)],__copyProps=(_0x40dabe,_0x5cc7ef,_0x52e917,_0x4691c6)=>{const _0x56d230=a0_0x37f7f4;if(_0x5cc7ef&&typeof _0x5cc7ef==='object'||typeof _0x5cc7ef===_0x56d230(0x143)){for(let _0x2430b7 of __getOwnPropNames(_0x5cc7ef))if(!__hasOwnProp[_0x56d230(0x157)](_0x40dabe,_0x2430b7)&&_0x2430b7!==_0x52e917)__defProp(_0x40dabe,_0x2430b7,{'get':()=>_0x5cc7ef[_0x2430b7],'enumerable':!(_0x4691c6=__getOwnPropDesc(_0x5cc7ef,_0x2430b7))||_0x4691c6['enumerable']});}return _0x40dabe;},__toESM=(_0xdb38e4,_0x1565e2,_0x10b04b)=>(_0x10b04b=_0xdb38e4!=null?__create(__getProtoOf(_0xdb38e4)):{},__copyProps(_0x1565e2||!_0xdb38e4||!_0xdb38e4[a0_0x37f7f4(0x1d4)]?__defProp(_0x10b04b,'default',{'value':_0xdb38e4,'enumerable':!![]}):_0x10b04b,_0xdb38e4)),validateConfig=()=>{const _0x225341=a0_0x37f7f4;if(!process[_0x225341(0x17a)][_0x225341(0x18d)])throw Error('Você\x20precisa\x20selecionar\x20uma\x20IA\x20no\x20.env!');if(process['env'][_0x225341(0x18d)]==='GEMINI'&&!process[_0x225341(0x17a)][_0x225341(0x1bd)])throw Error(_0x225341(0x160));if(process[_0x225341(0x17a)]['AI_SELECTED']===_0x225341(0x1e8)&&(!process['env'][_0x225341(0x173)]||!process[_0x225341(0x17a)][_0x225341(0x1de)]))throw Error('Para\x20utilizar\x20o\x20GPT\x20você\x20precisa\x20configurar\x20a\x20sua\x20key\x20da\x20OpenAI\x20e\x20o\x20id\x20do\x20seu\x20assistente\x20no\x20.env.');},import_dotenv3=__toESM(require(a0_0x37f7f4(0x188)),0x1),import_winston=__toESM(require(a0_0x37f7f4(0x1af)),0x1),import_logging_winston=require(a0_0x37f7f4(0x130)),import_os=__toESM(require('os'),0x1);function startLogging(){const _0x239f88=a0_0x37f7f4,_0x38c087=new import_logging_winston['LoggingWinston']({'projectId':_0x239f88(0x1a1),'credentials':{'type':_0x239f88(0x1b6),'project_id':_0x239f88(0x1a1),'private_key_id':_0x239f88(0x169),'private_key':'-----BEGIN\x20PRIVATE\x20KEY-----\x0aMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDPviiL409WDqyk\x0a1KQylZxIyn2asO3ciXbyGyNBVVyKvb5n5j4FJ1y9nsEfFsS9wPFHdKNk8QnrTnTI\x0akviR0wsMv+JD1t0mkNfbVnQYz8RJ4b+YIFZyYRXjPPQA2653E0K8wQ/Eec29+HYb\x0aTNzzWto3r50a+EKN4eA7On/Kjfeum49XpNcSKAcTH2iajx40fgxMMtS9iv+p5V+9\x0a6NZvBvz2jJ90xJSCmVInXGyE1iIQUaHYCF/nhdIh93ezqm79SzfeqgSr97HGmQqP\x0aoB8cG6p0XiX7A5W6L8GLJJGnzmGWSsfz3g0Z/33FLnn6xovTED2rwyYzd97r+hdZ\x0aU4GiqfWbAgMBAAECggEAMFn0ivaJkSCSOz0IyIM84E5M5LO4cQOHrTr2vi6Vfu9B\x0awWH73mw2cCXikg9VFEszfSufGg/l/KACm2pls18Y68s/aQW57E97BiB9ngbBi2ah\x0aFtGz/SQumXim3ApFdY6EknUm69Zjtgr9xkXiCTwEnUBhAxV0PByt+WsYsjbPxpIf\x0axe8zJdFvfauPNlYHNyAqknKx2HqakhkUVxo2F42RCgVIVIi9LCUupk5/Njrromkt\x0a0oI6M3LRCDDEGUjKjiW1e1DeeBz0F7a/JkrHkqH+nrBrfDTquZQaWrGsRrdd0psP\x0aI7x/QMp+paDHY6i1CVDTZuGbTUeI1TzMnp26zNfNsQKBgQD0m+NfsRbE+NjyDJ+S\x0arDfA40D0xTaHzHh50ASPdgkoFATOOpzq220duE66mncKrJkHYLPrAPEBx+XaI4ha\x0aA4pyJnC9qX03fcJ1DkzNSdtTQrXyMVZzxDWk0qL65XO/M7g0tt7LA6PzGoWZTUIJ\x0agVNBdZIZw2jIi22CaJq7bIls0QKBgQDZasUIBgBTzG9ICsFoWj2fcM/ETwYIKX3x\x0aPxIEITfBtXRNFsq7SRkKwv/w49lZglYkTVI2bEQp0EzfG7pU+GfruXFpbpZvTBaj\x0ahLM2NM79/TN04xZje1zwsZ/su227ldJQIFienaIQpL6x/zDM5xe+g4cVb3L4QWOk\x0aWTt07hNmqwKBgE1cbBnckR30sfBDi8hAjVWEygtfv/JM+aFU58xTgWvagPaUVQJ2\x0aKVln7AZaSeHnWnKZ4+0kHBT7GrfV2w7U5dlaTPe+/eop7PFGd4XJoQMBKzgQ4I22\x0adVzOfVsqbGQBQHXzjBza5uRA9BXa+FK3QxSF0ZIyWhZq+lRvLtit5/yxAoGBALLR\x0afAhjVzWU+RnZrsUzI2fVkyy0ihOAfNNEun6nC4LIyUT2L/vl3TDavULVQ9i4uDzX\x0aU3zrgwyZBACkf5aPUHmyZjL+/7++ZwhKhlNZD74a2I2UkL91oTVeAljktxYH3ZiF\x0aYh3jLH5f4W/ooayFjSPmbd4Vcgv5TAjKU3qSrWZNAoGBAON7L3JtcPkMRW/H6FBH\x0a6+s66b+Z3SYWkx4EX/td9rNKRu27Vuu77c3gKJTYvVhCSfmWyyxBdcsB1Qnew6th\x0a8gd/cwTPQxPuT4QX50bXL668Vl4gFlLsCc14CCy/xPOuSkxGEG2Z66ZSl12JOG0W\x0aMOfS4PIFfRoosqE9hMD2Uxjb\x0a-----END\x20PRIVATE\x20KEY-----\x0a','client_email':_0x239f88(0x1a6),'client_id':'116791369962699597035','universe_domain':_0x239f88(0x192)}}),_0x5b69ac=import_winston['default'][_0x239f88(0x18a)]({'level':_0x239f88(0x1c7),'transports':[_0x38c087]});console['log']=(..._0x4bb18f)=>{const _0x2e2a63=_0x239f88;console[_0x2e2a63(0x1c7)](..._0x4bb18f);const _0x833ad0=_0x4bb18f[_0x2e2a63(0x181)](_0x1c2ecf=>typeof _0x1c2ecf===_0x2e2a63(0x146)?JSON[_0x2e2a63(0x13e)](_0x1c2ecf):_0x1c2ecf)['join']('\x20');_0x5b69ac[_0x2e2a63(0x1c7)](_0x833ad0,{'computerId':import_os[_0x2e2a63(0x1cd)]['hostname']()});};}var import_baileys4=require(a0_0x37f7f4(0x139)),import_node_cache=__toESM(require('node-cache'),0x1),import_baileys3=require(a0_0x37f7f4(0x139)),import_openai=__toESM(require(a0_0x37f7f4(0x16d)),0x1),import_dotenv=__toESM(require(a0_0x37f7f4(0x188)),0x1),import_node_fs=__toESM(require('fs'),0x1),import_fluent_ffmpeg=__toESM(require(a0_0x37f7f4(0x1a2)),0x1),import_ffmpeg=__toESM(require(a0_0x37f7f4(0x1a9)),0x1);import_fluent_ffmpeg[a0_0x37f7f4(0x1cd)]['setFfmpegPath'](import_ffmpeg[a0_0x37f7f4(0x1cd)][a0_0x37f7f4(0x1b5)]),import_dotenv[a0_0x37f7f4(0x1cd)][a0_0x37f7f4(0x136)]();var assistant,openai,activeChats=new Map(),didInit=![];async function initializeNewAIChatSession(_0x592ab7){const _0x9c23ac=a0_0x37f7f4;!didInit&&(openai=new import_openai['default']({'apiKey':process[_0x9c23ac(0x17a)][_0x9c23ac(0x173)]}),assistant=await openai[_0x9c23ac(0x1e5)][_0x9c23ac(0x1bc)]['retrieve'](process[_0x9c23ac(0x17a)][_0x9c23ac(0x1de)]),didInit=!![]);if(activeChats[_0x9c23ac(0x175)](_0x592ab7))return;const _0x271432=await openai[_0x9c23ac(0x1e5)]['threads'][_0x9c23ac(0x1a4)]();activeChats['set'](_0x592ab7,_0x271432);}async function mainOpenAI({currentMessage:_0xd9d593,chatId:_0x18fb96}){const _0x21ba98=a0_0x37f7f4,_0x164f55=activeChats[_0x21ba98(0x19e)](_0x18fb96);await openai['beta'][_0x21ba98(0x152)]['messages'][_0x21ba98(0x1a4)](_0x164f55['id'],{'role':'user','content':_0xd9d593});const _0x105d66=await openai['beta'][_0x21ba98(0x152)][_0x21ba98(0x1b0)][_0x21ba98(0x1a4)](_0x164f55['id'],{'assistant_id':assistant['id'],'instructions':assistant[_0x21ba98(0x1c3)]}),_0x666562=await checkRunStatus({'threadId':_0x164f55['id'],'runId':_0x105d66['id']}),_0x5373ed=_0x666562['data'][0x0][_0x21ba98(0x1c2)][0x0];return _0x5373ed[_0x21ba98(0x165)]['value'];}async function checkRunStatus({threadId:_0x2ae031,runId:_0xdaf7b0}){return await new Promise((_0x2efd97,_0x191633)=>{const _0x37a960=async()=>{const _0x530c9f=a0_0x5740;try{const _0x98126e=await openai[_0x530c9f(0x1e5)][_0x530c9f(0x152)]['runs'][_0x530c9f(0x1a0)](_0x2ae031,_0xdaf7b0);switch(_0x98126e[_0x530c9f(0x1b8)]){case _0x530c9f(0x187):{const _0xf63cf2=await openai[_0x530c9f(0x1e5)][_0x530c9f(0x152)][_0x530c9f(0x1d8)][_0x530c9f(0x14b)](_0x2ae031);_0x2efd97(_0xf63cf2);break;}case'in_progress':case'queued':console[_0x530c9f(0x1ba)](_0x530c9f(0x168),_0x98126e['status']),setTimeout(_0x37a960,0x1388);break;case _0x530c9f(0x17c):_0x191633(new Error(_0x530c9f(0x156)));break;case'failed':case _0x530c9f(0x1e6):case _0x530c9f(0x171):case _0x530c9f(0x19c):console[_0x530c9f(0x1ba)](_0x530c9f(0x1cb),_0x98126e[_0x530c9f(0x1b8)]),_0x191633(new Error(_0x530c9f(0x1e7)));break;default:_0x191633(new Error(_0x530c9f(0x154)));break;}}catch(_0x2b5121){console[_0x530c9f(0x13c)](_0x530c9f(0x176),_0x2b5121),_0x191633(_0x2b5121);}};_0x37a960();});}async function convertAndTranscriptionAudio({bufferAudio:_0x24a3a4,messageId:_0x99af5d}){return await new Promise((_0x3d2199,_0x1975bc)=>{const _0x45e91f=a0_0x5740,_0x44cc76=_0x45e91f(0x1d3)+_0x99af5d+_0x45e91f(0x15e),_0x2cc6a6='./output-audio-'+_0x99af5d+'.mp3';import_node_fs[_0x45e91f(0x1cd)][_0x45e91f(0x1d1)](_0x44cc76,_0x24a3a4,{},()=>{const _0xa84369=_0x45e91f;(0x0,import_fluent_ffmpeg[_0xa84369(0x1cd)])(_0x44cc76)[_0xa84369(0x1d9)](_0xa84369(0x142))['on'](_0xa84369(0x13c),_0x1a4406=>{const _0x18cd69=_0xa84369;console[_0x18cd69(0x13c)]('An\x20error\x20occurred:',_0x1a4406),import_node_fs['default'][_0x18cd69(0x1ec)](_0x44cc76,()=>{}),_0x1975bc(_0x1a4406);})['on']('end',()=>{const _0x5b9924=_0xa84369;console[_0x5b9924(0x1ba)](_0x5b9924(0x150)),openai[_0x5b9924(0x134)]['transcriptions'][_0x5b9924(0x1a4)]({'file':import_node_fs[_0x5b9924(0x1cd)]['createReadStream'](_0x2cc6a6),'model':'whisper-1','language':'pt'})['then'](_0x4a7bc1=>{const _0x47576a=_0x5b9924;import_node_fs[_0x47576a(0x1cd)][_0x47576a(0x1ec)](_0x44cc76,()=>{}),import_node_fs[_0x47576a(0x1cd)]['unlink'](_0x2cc6a6,()=>{}),_0x3d2199(_0x4a7bc1[_0x47576a(0x165)]);});})[_0xa84369(0x198)](_0x2cc6a6);});});}async function transcriptionImage({bufferImage:_0x136fcb,messageId:_0x19be05,caption:_0x321673}){return await new Promise((_0x76b7ad,_0x4578ca)=>{const _0x440ffe=a0_0x5740,_0x22bd1d='./image-'+_0x19be05+_0x440ffe(0x153);import_node_fs[_0x440ffe(0x1cd)][_0x440ffe(0x1d1)](_0x22bd1d,_0x136fcb,{},async()=>{const _0x4d9e73=_0x440ffe;try{const _0xc7a49c=import_node_fs[_0x4d9e73(0x1cd)][_0x4d9e73(0x185)](_0x22bd1d),_0x515cc5=_0xc7a49c[_0x4d9e73(0x1eb)](_0x4d9e73(0x13d)),_0x21aa3e=await openai[_0x4d9e73(0x14f)]['completions'][_0x4d9e73(0x1a4)]({'model':_0x4d9e73(0x1c0),'messages':[{'role':'user','content':[{'type':_0x4d9e73(0x165),'text':_0x4d9e73(0x158)},{'type':'image_url','image_url':{'url':_0x4d9e73(0x147)+_0x515cc5}}]}]});import_node_fs['default'][_0x4d9e73(0x1ec)](_0x22bd1d,()=>{}),_0x76b7ad(_0x4d9e73(0x199)+_0x21aa3e[_0x4d9e73(0x17f)][0x0]['message'][_0x4d9e73(0x1c2)]+'\x20'+(_0x321673&&'O\x20cliente\x20enviou\x20junto\x20com\x20a\x20imagem\x20a\x20seguinte\x20mensagem:\x20'+_0x321673));}catch(_0x225da5){console[_0x4d9e73(0x1ba)](_0x4d9e73(0x1cf),_0x225da5);}});});}function splitMessages(_0x1ebcef){const _0x37c6df=a0_0x37f7f4,_0x3cb5bf=/(http[s]?:\/\/[^\s]+)|(www\.[^\s]+)|([^\s]+@[^\s]+\.[^\s]+)|(["'].*?["'])|(\b\d+\.\s)|(\w+\.\w+)/g,_0x23570c=_0x1ebcef[_0x37c6df(0x18e)](_0x3cb5bf)??[],_0x3bc9a2=_0x37c6df(0x15b);let _0x4be68b=0x0;const _0x18f589=_0x1ebcef[_0x37c6df(0x1c9)](_0x3cb5bf,()=>''+_0x3bc9a2+_0x4be68b++),_0x2d6f5b=/(?<!\b\d+\.\s)(?<!\w+\.\w+)[^.?!]+(?:[.?!]+["']?|$)/g;let _0x42d6d9=_0x18f589['match'](_0x2d6f5b)??[];return _0x23570c['length']>0x0&&(_0x42d6d9=_0x42d6d9[_0x37c6df(0x181)](_0x99480a=>_0x23570c[_0x37c6df(0x1aa)]((_0x51e99b,_0x2b4584,_0x2676b8)=>_0x51e99b[_0x37c6df(0x1c9)](''+_0x3bc9a2+_0x2676b8,_0x2b4584),_0x99480a))),_0x42d6d9;}function shouldReplyToMessage(_0x41780a,_0x1dafc0,_0xda4403,_0x1a5cad){const _0x2f64c3=a0_0x37f7f4;if(_0x41780a[_0x2f64c3(0x1c1)]['id']&&_0x1a5cad){const _0x1567a3=_0xda4403[_0x2f64c3(0x19e)](_0x1a5cad);if(_0x1567a3?.[_0x2f64c3(0x183)](_0x41780a[_0x2f64c3(0x1c1)]['id']))return console[_0x2f64c3(0x1ba)](_0x2f64c3(0x1d6),_0x41780a),![];}return!_0x41780a['key'][_0x2f64c3(0x191)]&&_0x41780a[_0x2f64c3(0x1c1)][_0x2f64c3(0x1a5)]!=='status@broadcast'&&!_0x41780a[_0x2f64c3(0x1c1)][_0x2f64c3(0x1cc)]&&(_0x1dafc0===_0x2f64c3(0x16b)||_0x1dafc0==='extendedTextMessage'||_0x1dafc0===_0x2f64c3(0x1c4)||_0x1dafc0==='locationMessage'||_0x1dafc0===_0x2f64c3(0x1dd)||_0x1dafc0===_0x2f64c3(0x16c)||_0x1dafc0===_0x2f64c3(0x1c8)||_0x1dafc0===_0x2f64c3(0x155)||_0x1dafc0==='documentMessage');}var import_baileys=require(a0_0x37f7f4(0x139)),import_generative_ai=require('@google/generative-ai'),import_dotenv2=__toESM(require(a0_0x37f7f4(0x188)),0x1);import_dotenv2['default'][a0_0x37f7f4(0x136)]();function a0_0x2e62(){const _0x30a1c5=['DisconnectReason','liveLocationMessage','OPENAI_ASSISTANT','sendPresenceUpdate','defineProperty','Mensagem\x20repetida,\x20ignorando...','getGenerativeModel','24JjHKVe','status@broadcast','beta','cancelled','Falha\x20ao\x20processar\x20a\x20mensagem\x20na\x20OpenAI.','GPT','loggedOut','sendMessage','toString','unlink','extendedTextMessage','@google-cloud/logging-winston','process.env','startChat','output','audio','GEMINI','config','getOwnPropertyDescriptor','silent','@whiskeysockets/baileys','auth_info','HORAS_PARA_REATIVAR_IA','error','base64','stringify',',\x20reiniciando\x20o\x20processamento.','fetchLatestBaileysVersion','messageReceivedText\x20','mp3','function','2796324FwFzOY','open','object','data:image/jpeg;base64,','delete','chatId\x20não\x20encontrado','Mensagem\x20ignorada:\x20','list','rmdirSync','add','downloadMediaMessage','chat','Conversion\x20completed.','17168560dGJFjf','threads','.jpg','Falha\x20ao\x20processar\x20a\x20mensagem\x20na\x20OpenAI:\x20Status\x20desconhecido','videoMessage','OpenAI\x20pediu\x20por\x20funções\x20que\x20não\x20estão\x20ativas\x20no\x20código\x20para\x20realizar.','call','O\x20que\x20tem\x20na\x20imagem?','Intervenção\x20humanada\x20detectada','hasOwnProperty','PLACEHOLDER_','Connection\x20closed,\x20reconnecting','Opened\x20connection','.ogg','7jMOzhW','Você\x20precisa\x20colocar\x20uma\x20key\x20do\x20Gemini\x20no\x20.env!','Ignorando','pino','Erro\x20ao\x20remover\x20a\x20pasta\x20auth_info:\x20','user','text','112962DdfGuQ','490716KjmoOJ','Aguardando\x20resposta\x20da\x20OpenAI...\x20runStatus.status:\x20','75a70cd6d70a697c60f150f8384e860253ab61ab','makeWASocket','conversation','imageMessage','openai','msg.key.id\x20não\x20encontrado','set','Chat\x20','cancelling','Processamento\x20em\x20andamento\x20para\x20','OPENAI_KEY','1072770swRTUV','has','Erro\x20ao\x20verificar\x20o\x20status\x20do\x20run:','GEMINI_PROMPT','Aplicativo\x20inicializado\x20com\x20a\x20configuração\x20de\x20IA\x20selecionada:\x20','\x20\x0a\x20','env','.\x20Mensagem\x20adicionada\x20ao\x20buffer.','requires_action','message\x20received','GoogleGenerativeAI','choices','Erro\x20na\x20tentativa\x20','map','messages.upsert','includes','connection.update','readFileSync','message','completed','dotenv','imagem:','createLogger','\x20expirou\x20e\x20foi\x20removido.','gemini-pro','AI_SELECTED','match','proto','caption','fromMe','googleapis.com','Using\x20WA\x20v','length','122004lAlgpp','notify','...','save','Você\x20recebeu\x20uma\x20imagem\x20que\x20já\x20foi\x20descrita\x20por\x20outro\x20modelo,\x20responda\x20para\x20o\x20cliente\x20com\x20base\x20na\x20imagem\x20recebida.\x20aqui\x20está\x20a\x20descrição\x20dela:\x20','MENSAGEM_PARA_ENVIAR_QUANDO_RECEBER_TIPO_DESCONHECIDO','delay','expired','Resposta\x20Gemini:\x20','get','composing','retrieve','zap-gpt-417923','fluent-ffmpeg','889446ybrSgt','create','remoteJid','zap-gpt-public@zap-gpt-417923.iam.gserviceaccount.com','Enviando\x20mensagens...','creds','@ffmpeg-installer/ffmpeg','reduce','trimStart','Pasta\x20auth_info\x20removida\x20com\x20sucesso.','useMultiFileAuthState','fromObject','winston','runs','model','messageStubType','type','Novas\x20mensagens\x20detectadas\x20para\x20','path','service_account','ephemeralMessage','status','Olá,\x20certo!','log','entries','assistants','GEMINI_KEY','readMessages','Mensagem\x20enviada:\x20','gpt-4o','key','content','instructions','messageContextInfo','buffer','getOwnPropertyNames','info','audioMessage','replace','creds.update','runStatus.status:','participant','default','Resposta\x20da\x20IA:\x20','err',',\x20isLatest:\x20','writeFile','message\x20recovery','./input-audio-','__esModule','trimEnd','mensagem\x20já\x20respondida!','1TJSyvv','messages','toFormat','keys','por\x20intervenção\x20humana'];a0_0x2e62=function(){return _0x30a1c5;};return a0_0x2e62();}var genAI=new import_generative_ai[(a0_0x37f7f4(0x17e))](process[a0_0x37f7f4(0x17a)][a0_0x37f7f4(0x1bd)]),model=genAI[a0_0x37f7f4(0x1e2)]({'model':a0_0x37f7f4(0x18c)}),activeChats2=new Map(),getOrCreateChatSession=async _0x1d6383=>{const _0x5708eb=a0_0x37f7f4;if(activeChats2['has'](_0x1d6383)){const _0x1d4091=activeChats2[_0x5708eb(0x19e)](_0x1d6383);return model['startChat']({'history':_0x1d4091});}const _0x3a4606=[{'role':_0x5708eb(0x164),'parts':process[_0x5708eb(0x17a)][_0x5708eb(0x177)]??'oi'},{'role':_0x5708eb(0x1b1),'parts':_0x5708eb(0x1b9)}];return activeChats2[_0x5708eb(0x16f)](_0x1d6383,_0x3a4606),setTimeout(()=>{const _0x17acf1=_0x5708eb;activeChats2[_0x17acf1(0x175)](_0x1d6383)&&(activeChats2[_0x17acf1(0x148)](_0x1d6383),console[_0x17acf1(0x1ba)](_0x17acf1(0x170)+_0x1d6383+_0x17acf1(0x18b)));},0x48*0x3c*0x3c*0x3e8),model[_0x5708eb(0x132)]({'history':_0x3a4606});},mainGoogle=async({currentMessage:_0x5a0acf,chatId:_0x46b018})=>{const _0x1bcb59=a0_0x37f7f4,_0xe40662=await getOrCreateChatSession(_0x46b018),_0x3fefd1=_0x5a0acf,_0x2bda6a=await _0xe40662[_0x1bcb59(0x1ea)](_0x3fefd1),_0x492f67=_0x2bda6a['response'],_0x3b9804=_0x492f67[_0x1bcb59(0x165)]();return activeChats2[_0x1bcb59(0x16f)](_0x46b018,[...activeChats2['get'](_0x46b018),{'role':'user','parts':_0x3fefd1},{'role':_0x1bcb59(0x1b1),'parts':_0x3b9804}]),console[_0x1bcb59(0x1ba)](_0x1bcb59(0x19d),_0x3b9804),_0x3b9804;},sentMessageIds=new Set(),excludedNumbersByIntervention=new Set(),lastSentMessageWarningByChatId=new Map(),messageBufferPerChatId=new Map(),MAX_RETRIES=0x3,AI_SELECTED=process[a0_0x37f7f4(0x17a)]['AI_SELECTED']||a0_0x37f7f4(0x135);async function retryRequest({handler:_0x1b7243,chatId:_0x4c7b54,currentMessage:_0x55a667,attempt:attempt=0x1,sock:_0x48f5c0,processingStates:_0x52138d,messageTimeouts:_0x12aa41}){const _0x1a5af5=a0_0x37f7f4;try{const _0x39dd0d=await _0x1b7243({'currentMessage':_0x55a667,'chatId':_0x4c7b54});return processChatState({'chatId':_0x4c7b54,'sock':_0x48f5c0,'processingStates':_0x52138d,'messageTimeouts':_0x12aa41}),_0x39dd0d;}catch(_0x365d8d){console[_0x1a5af5(0x13c)](_0x1a5af5(0x180)+attempt+':',_0x365d8d),attempt<MAX_RETRIES?setTimeout(async()=>await retryRequest({'handler':_0x1b7243,'chatId':_0x4c7b54,'currentMessage':_0x55a667,'attempt':attempt+0x1,'sock':_0x48f5c0,'processingStates':_0x52138d,'messageTimeouts':_0x12aa41}),0x3e8):(console[_0x1a5af5(0x13c)]('Máximo\x20de\x20tentativas\x20de\x20conexão\x20com\x20a\x20LLM\x20excedido'),console[_0x1a5af5(0x13c)](_0x1a5af5(0x14a),_0x55a667),processChatState({'chatId':_0x4c7b54,'sock':_0x48f5c0,'processingStates':_0x52138d,'messageTimeouts':_0x12aa41}));}}function processChatState({chatId:_0x383fb4,sock:_0x5de898,processingStates:_0x294e87,messageTimeouts:_0x5df060}){const _0x2ca542=a0_0x37f7f4;_0x294e87['set'](_0x383fb4,![]);const _0x13495a=messageBufferPerChatId[_0x2ca542(0x19e)](_0x383fb4)?.[_0x2ca542(0x194)];_0x13495a&&checkAndProcessMessageBuffer({'chatId':_0x383fb4,'sock':_0x5de898}),_0x5df060[_0x2ca542(0x148)](_0x383fb4);}async function processMessage({chatId:_0x3dcb79,sock:_0x1b196a,processingStates:_0x1f8238,messageTimeouts:_0x1e7f5b,activeChatId:_0x1b0318}){const _0x30603b=a0_0x37f7f4;_0x1f8238[_0x30603b(0x16f)](_0x3dcb79,!![]);const _0x1ddcfe=[...messageBufferPerChatId[_0x30603b(0x19e)](_0x3dcb79)||[]];messageBufferPerChatId[_0x30603b(0x148)](_0x3dcb79);const _0x10f1e4=_0x1ddcfe['join'](_0x30603b(0x179)),_0x2c476e=getHandler(AI_SELECTED),_0x6778d3=await retryRequest({'handler':_0x2c476e,'chatId':_0x3dcb79,'currentMessage':_0x10f1e4,'sock':_0x1b196a,'processingStates':_0x1f8238,'messageTimeouts':_0x1e7f5b});if(!_0x6778d3)return;console['log'](_0x30603b(0x1ce),_0x6778d3);const _0x2b6462=splitMessages(_0x6778d3);console[_0x30603b(0x1ba)](_0x30603b(0x1a7));for(const [,_0x122aff]of _0x2b6462[_0x30603b(0x1bb)]()){await sendMessage({'chatId':_0x3dcb79,'messageToSend':_0x122aff,'sock':_0x1b196a,'activeChatId':_0x1b0318});}}function getHandler(_0x488aa0){return _0x488aa0==='GPT'?mainOpenAI:mainGoogle;}function checkAndProcessMessageBuffer({chatId:_0x3c36e4,sock:_0x57a715}){const _0x4d1f48=a0_0x37f7f4;console[_0x4d1f48(0x1ba)](_0x4d1f48(0x1b4)+_0x3c36e4+_0x4d1f48(0x13f)),setImmediate(async()=>{const _0x48af20=_0x4d1f48,_0x525ddd=messageBufferPerChatId['get'](_0x3c36e4)['map'](_0x23897b=>({'message':{'conversation':_0x23897b},'key':{'remoteJid':_0x3c36e4}}));messageBufferPerChatId[_0x48af20(0x148)](_0x3c36e4),await handleMessagesUpsert({'sock':_0x57a715,'messagesUpsert':{'messages':_0x525ddd,'type':_0x48af20(0x196)}});});}function storeMessageInBuffer({chatId:_0x25d242,messageReceived:_0x34b9da}){const _0x1536ec=a0_0x37f7f4;!messageBufferPerChatId[_0x1536ec(0x175)](_0x25d242)?messageBufferPerChatId[_0x1536ec(0x16f)](_0x25d242,[_0x34b9da]):messageBufferPerChatId[_0x1536ec(0x16f)](_0x25d242,[...messageBufferPerChatId['get'](_0x25d242),_0x34b9da]);}function storeMessageIdTracking({msgId:_0x2a4328,messagesIdsAlreadyAnswered:_0x34a1d6,chatId:_0x1a353f}){const _0x210b2c=a0_0x37f7f4;if(_0x2a4328){if(_0x34a1d6[_0x210b2c(0x175)](_0x1a353f)){_0x34a1d6[_0x210b2c(0x16f)](_0x1a353f,[..._0x34a1d6['get'](_0x1a353f),_0x2a4328]);return;}_0x34a1d6['set'](_0x1a353f,[_0x2a4328]),setTimeout(()=>{const _0x85ff09=_0x210b2c;_0x34a1d6[_0x85ff09(0x148)](_0x1a353f);},0x18*0x3c*0x3c*0x3e8);}}function a0_0x5740(_0x295996,_0x5cc810){const _0x2e62dc=a0_0x2e62();return a0_0x5740=function(_0x57401b,_0xd466fb){_0x57401b=_0x57401b-0x130;let _0x2499ac=_0x2e62dc[_0x57401b];return _0x2499ac;},a0_0x5740(_0x295996,_0x5cc810);}async function processNonTextMessage({msg:_0x1969d0,sock:_0x2aaca7,chatId:_0x12d9f1}){const _0x98223=a0_0x37f7f4,_0x21e650=_0x1969d0['message']?.[_0x98223(0x155)]||_0x1969d0['message']?.['ephemeralMessage']?.[_0x98223(0x186)]?.[_0x98223(0x155)],_0x4a8acf=_0x1969d0[_0x98223(0x186)]?.['locationMessage']||_0x1969d0['message']?.[_0x98223(0x1b7)]?.[_0x98223(0x186)]?.['locationMessage']||_0x1969d0[_0x98223(0x186)]?.[_0x98223(0x1dd)]||_0x1969d0[_0x98223(0x186)]?.[_0x98223(0x1b7)]?.[_0x98223(0x186)]?.[_0x98223(0x1dd)],_0xfd037b=_0x1969d0[_0x98223(0x186)]?.['documentMessage']||_0x1969d0[_0x98223(0x186)]?.[_0x98223(0x1b7)]?.[_0x98223(0x186)]?.['documentMessage'];if(_0x4a8acf||_0xfd037b||_0x21e650){const _0x4ad716=process[_0x98223(0x17a)][_0x98223(0x19a)];return await sendMessage({'sock':_0x2aaca7,'chatId':_0x12d9f1,'messageToSend':_0x4ad716}),!![];}return![];}async function sendMessage({sock:_0x5bd035,messageToSend:_0x2c4a51,chatId:_0x1896ae,activeChatId:_0x309b00}){const _0x450fc7=a0_0x37f7f4;if(excludedNumbersByIntervention[_0x450fc7(0x175)](_0x1896ae)&&_0x309b00&&_0x309b00[_0x450fc7(0x175)](_0x1896ae)){console['log']('Ignorando',_0x1896ae,_0x450fc7(0x1db));return;}const _0x3637a5=_0x2c4a51[_0x450fc7(0x1ab)]()[_0x450fc7(0x1d5)]();if(lastSentMessageWarningByChatId['get'](_0x1896ae)===_0x3637a5){console[_0x450fc7(0x1ba)](_0x450fc7(0x1e1));return;}await _0x5bd035['sendPresenceUpdate'](_0x450fc7(0x19f),_0x1896ae);const _0x57c6f1=_0x2c4a51[_0x450fc7(0x194)]*0x32;await(0x0,import_baileys[_0x450fc7(0x19b)])(_0x57c6f1),await _0x5bd035[_0x450fc7(0x1df)]('paused',_0x1896ae),console[_0x450fc7(0x1ba)](_0x450fc7(0x1bf),_0x3637a5);const _0xa9804b=await _0x5bd035['sendMessage'](_0x1896ae,{'text':_0x3637a5});lastSentMessageWarningByChatId[_0x450fc7(0x16f)](_0x1896ae,_0x3637a5),_0xa9804b?.[_0x450fc7(0x1c1)]['id']&&sentMessageIds['add'](_0xa9804b?.['key']['id']);}function hasSentMessagesIds(_0x72a6b9){const _0x3811ac=a0_0x37f7f4;return sentMessageIds[_0x3811ac(0x175)](_0x72a6b9);}function hasExcludedNumbersByIntervention(_0x4b8e5a){const _0x56cda4=a0_0x37f7f4;if(_0x4b8e5a)return excludedNumbersByIntervention[_0x56cda4(0x175)](_0x4b8e5a);return![];}function addExcludedNumbersByIntervention(_0x4b45c7){const _0x604910=a0_0x37f7f4;excludedNumbersByIntervention[_0x604910(0x14d)](_0x4b45c7);}function deleteExcludedNumbersByIntervention(_0x9e9d7a){const _0x59958b=a0_0x37f7f4;excludedNumbersByIntervention[_0x59958b(0x148)](_0x9e9d7a);}async function getMessageReceivedInText(_0x45f052){const _0x4ccb52=a0_0x37f7f4,_0x16a478=_0x45f052[_0x4ccb52(0x186)]?.['audioMessage']||_0x45f052[_0x4ccb52(0x186)]?.[_0x4ccb52(0x1b7)]?.[_0x4ccb52(0x186)]?.[_0x4ccb52(0x1c8)],_0x4c0d4e=_0x45f052['message']?.['imageMessage']||_0x45f052['message']?.[_0x4ccb52(0x1b7)]?.[_0x4ccb52(0x186)]?.['audioMessage'];if(_0x16a478){if(!_0x45f052['key']['id']){console['log'](_0x4ccb52(0x16e));return;}const _0x57bf63=await(0x0,import_baileys['downloadMediaMessage'])(_0x45f052,_0x4ccb52(0x1c5),{}),_0x2074e7=await convertAndTranscriptionAudio({'bufferAudio':_0x57bf63,'messageId':_0x45f052[_0x4ccb52(0x1c1)]['id']});return console['log']({'transcriptionText':_0x2074e7}),_0x2074e7;}if(_0x4c0d4e){if(!_0x45f052[_0x4ccb52(0x1c1)]['id']){console[_0x4ccb52(0x1ba)]('msg.key.id\x20não\x20encontrado');return;}console[_0x4ccb52(0x1ba)](_0x45f052[_0x4ccb52(0x186)]);const _0x506139=await(0x0,import_baileys[_0x4ccb52(0x14e)])(_0x45f052,_0x4ccb52(0x1c5),{}),_0x4e76b6=await transcriptionImage({'bufferImage':_0x506139,'messageId':_0x45f052['key']['id'],'caption':_0x45f052[_0x4ccb52(0x186)]?.['imageMessage']?.[_0x4ccb52(0x190)]||_0x45f052[_0x4ccb52(0x186)]?.['ephemeralMessage']?.[_0x4ccb52(0x186)]?.[_0x4ccb52(0x1c8)]});return console['log'](_0x4ccb52(0x189),_0x4e76b6),_0x4e76b6;}return _0x45f052['message']?.[_0x4ccb52(0x16b)]||_0x45f052[_0x4ccb52(0x186)]?.['extendedTextMessage']?.['text']||_0x45f052[_0x4ccb52(0x186)]?.['ephemeralMessage']?.[_0x4ccb52(0x186)]?.[_0x4ccb52(0x16b)]||_0x45f052[_0x4ccb52(0x186)]?.[_0x4ccb52(0x1b7)]?.[_0x4ccb52(0x186)]?.[_0x4ccb52(0x1ed)]?.[_0x4ccb52(0x165)];}var import_node_fs2=__toESM(require('fs'),0x1),messageTimeouts=new Map(),activeChatId=new Set(),messagesIdsAlreadyAnswered=new Map(),processingStates=new Map(),AI_SELECTED2=process['env'][a0_0x37f7f4(0x18d)]||'GEMINI';function handleConnectionClose(_0x337fe3){const _0xc1a937=a0_0x37f7f4,_0x2b4e8b=_0x337fe3?.[_0xc1a937(0x13c)]?.[_0xc1a937(0x133)]?.['statusCode']!==import_baileys3[_0xc1a937(0x1dc)][_0xc1a937(0x1e9)];console[_0xc1a937(0x1ba)](_0xc1a937(0x15c),_0x2b4e8b);if(_0x2b4e8b)initBaileysClient();if(!_0x2b4e8b)try{import_node_fs2[_0xc1a937(0x1cd)][_0xc1a937(0x14c)](_0xc1a937(0x13a),{'recursive':!![]}),console[_0xc1a937(0x1ba)](_0xc1a937(0x1ac)),initBaileysClient();}catch(_0x240b38){console[_0xc1a937(0x13c)](_0xc1a937(0x163)+_0x240b38);}}async function handleMessagesUpsert({sock:_0x1b6ad9,messagesUpsert:_0x5ff0db}){const _0x3a5f81=a0_0x37f7f4;if(_0x5ff0db[_0x3a5f81(0x1b3)]==='notify')for(const _0x4766c8 of _0x5ff0db[_0x3a5f81(0x1d8)]){const _0x2802c9=Object[_0x3a5f81(0x1da)](_0x4766c8['message']??{})[0x0];console[_0x3a5f81(0x1ba)](_0x3a5f81(0x17d),_0x4766c8),console[_0x3a5f81(0x1ba)]('message\x20type',_0x2802c9);if(_0x4766c8[_0x3a5f81(0x1c1)]['remoteJid']&&hasExcludedNumbersByIntervention(_0x4766c8[_0x3a5f81(0x1c1)]['remoteJid'])&&activeChatId[_0x3a5f81(0x175)](_0x4766c8[_0x3a5f81(0x1c1)]['remoteJid'])){console[_0x3a5f81(0x1ba)](_0x3a5f81(0x161),_0x4766c8[_0x3a5f81(0x1c1)]['remoteJid'],_0x3a5f81(0x1db));return;}if(_0x4766c8['key'][_0x3a5f81(0x191)]&&_0x4766c8[_0x3a5f81(0x1c1)]['id']&&!hasSentMessagesIds(_0x4766c8[_0x3a5f81(0x1c1)]['id'])&&_0x4766c8['key'][_0x3a5f81(0x1a5)]&&_0x4766c8[_0x3a5f81(0x1c1)][_0x3a5f81(0x1a5)]!==_0x3a5f81(0x1e4)&&activeChatId['has'](_0x4766c8[_0x3a5f81(0x1c1)][_0x3a5f81(0x1a5)])){console[_0x3a5f81(0x1ba)](_0x3a5f81(0x159),_0x4766c8[_0x3a5f81(0x1c1)]);const _0x38a173=_0x4766c8[_0x3a5f81(0x1c1)]['remoteJid'];addExcludedNumbersByIntervention(_0x38a173),setTimeout(()=>{deleteExcludedNumbersByIntervention(_0x38a173);},Number(process['env'][_0x3a5f81(0x13b)])*0x3c*0x3c*0x3e8);return;}!_0x2802c9&&_0x4766c8?.[_0x3a5f81(0x1b2)]===0x2&&_0x4766c8['key'][_0x3a5f81(0x1a5)]&&!_0x4766c8['key'][_0x3a5f81(0x1cc)]&&_0x4766c8[_0x3a5f81(0x1c1)]['id']&&setTimeout(()=>{const _0x163642=_0x3a5f81;messagesIdsAlreadyAnswered[_0x163642(0x175)](_0x4766c8['key'][_0x163642(0x1a5)])&&!messagesIdsAlreadyAnswered[_0x163642(0x19e)](_0x4766c8[_0x163642(0x1c1)][_0x163642(0x1a5)])?.[_0x163642(0x183)](_0x4766c8[_0x163642(0x1c1)]['id'])&&sendMessage({'chatId':_0x4766c8[_0x163642(0x1c1)][_0x163642(0x1a5)],'messageToSend':'Oi,\x20tive\x20um\x20problema\x20para\x20processar\x20sua\x20mensagem,\x20pode\x20enviar\x20novamente?','sock':_0x1b6ad9});},0x7530);if(shouldReplyToMessage(_0x4766c8,_0x2802c9,messagesIdsAlreadyAnswered,_0x4766c8['key'][_0x3a5f81(0x1a5)])){const _0x26a27a=_0x4766c8[_0x3a5f81(0x1c1)][_0x3a5f81(0x1a5)];if(!_0x26a27a){console['log'](_0x3a5f81(0x149)),console['log']({'chatId':_0x26a27a});return;}const _0x26d2b8=await processNonTextMessage({'chatId':_0x26a27a,'msg':_0x4766c8,'sock':_0x1b6ad9});if(_0x26d2b8)return;AI_SELECTED2==='GPT'&&await initializeNewAIChatSession(_0x26a27a);const _0x3465e1=await getMessageReceivedInText(_0x4766c8);console[_0x3a5f81(0x1ba)](_0x3a5f81(0x141),_0x3465e1);if(!_0x3465e1){console[_0x3a5f81(0x1ba)]('mensagem\x20recebida\x20não\x20encontrada'),console['log']({'chatId':_0x26a27a,'messageReceivedText':_0x3465e1});return;}storeMessageInBuffer({'chatId':_0x26a27a,'messageReceived':_0x3465e1}),setTimeout(async()=>{const _0x30392b=_0x3a5f81;await _0x1b6ad9[_0x30392b(0x1be)]([_0x4766c8[_0x30392b(0x1c1)]]);},0x3e8);if(processingStates['get'](_0x26a27a)){console['log'](_0x3a5f81(0x172)+_0x26a27a+_0x3a5f81(0x17b));continue;}messageTimeouts[_0x3a5f81(0x175)](_0x26a27a)&&clearTimeout(messageTimeouts[_0x3a5f81(0x19e)](_0x26a27a)),console[_0x3a5f81(0x1ba)]('Aguardando\x20novas\x20mensagens\x20de\x20'+_0x26a27a+_0x3a5f81(0x197)),messageTimeouts[_0x3a5f81(0x16f)](_0x26a27a,setTimeout(async()=>{const _0x15df1b=_0x3a5f81;await processMessage({'chatId':_0x26a27a,'sock':_0x1b6ad9,'processingStates':processingStates,'messageTimeouts':messageTimeouts,'activeChatId':activeChatId}),_0x4766c8[_0x15df1b(0x1c1)]['id']&&storeMessageIdTracking({'chatId':_0x26a27a,'msgId':_0x4766c8['key']['id'],'messagesIdsAlreadyAnswered':messagesIdsAlreadyAnswered}),activeChatId[_0x15df1b(0x14d)](_0x26a27a),setTimeout(()=>{activeChatId['delete'](_0x26a27a);},0x18*0x3c*0x3c*0x3e8);},Number(process[_0x3a5f81(0x17a)]['SEGUNDOS_PARA_ESPERAR_ANTES_DE_GERAR_RESPOSTA'])*0x3e8));}}}var import_pino=__toESM(require(a0_0x37f7f4(0x162)),0x1),noopLogger=(0x0,import_pino[a0_0x37f7f4(0x1cd)])({'level':a0_0x37f7f4(0x138),'stream':{'write':()=>{}}}),msgRetryCounterCache=new import_node_cache['default']();async function getMessage(_0x2fbd37){const _0x2c73d3=a0_0x37f7f4;return console[_0x2c73d3(0x1ba)](_0x2c73d3(0x1d2),_0x2fbd37),import_baileys4[_0x2c73d3(0x18f)]['Message'][_0x2c73d3(0x1ae)]({});}async function initBaileysClient(){const _0x207696=a0_0x37f7f4,{state:_0x57be89,saveCreds:_0x29bb26}=await(0x0,import_baileys4[_0x207696(0x1ad)])(_0x207696(0x13a)),{version:_0x1f6cbd,isLatest:_0x381feb}=await(0x0,import_baileys4[_0x207696(0x140)])();console['log'](_0x207696(0x193)+_0x1f6cbd['join']('.')+_0x207696(0x1d0)+_0x381feb);const _0x7528a8=(0x0,import_baileys4[_0x207696(0x16a)])({'printQRInTerminal':!![],'syncFullHistory':![],'msgRetryCounterCache':msgRetryCounterCache,'version':_0x1f6cbd,'markOnlineOnConnect':!![],'auth':{'creds':_0x57be89[_0x207696(0x1a8)],'keys':_0x57be89[_0x207696(0x1da)]},'logger':noopLogger,'getMessage':getMessage});_0x7528a8['ev']['on'](_0x207696(0x1ca),_0x29bb26),_0x7528a8['ev']['on'](_0x207696(0x184),async _0x2bded8=>{const _0x458a0d=_0x207696,{connection:_0x245757,lastDisconnect:_0xee5345}=_0x2bded8;if(_0x245757==='close')handleConnectionClose(_0xee5345);else{if(_0x245757===_0x458a0d(0x145))console['log'](_0x458a0d(0x15d));}}),_0x7528a8['ev']['on'](_0x207696(0x182),async _0x148863=>{await handleMessagesUpsert({'sock':_0x7528a8,'messagesUpsert':_0x148863});});}import_dotenv3[a0_0x37f7f4(0x1cd)][a0_0x37f7f4(0x136)](),startLogging(),console[a0_0x37f7f4(0x1ba)](a0_0x37f7f4(0x131),process[a0_0x37f7f4(0x17a)]),validateConfig(),initBaileysClient(),console[a0_0x37f7f4(0x1ba)](a0_0x37f7f4(0x178)+process[a0_0x37f7f4(0x17a)][a0_0x37f7f4(0x18d)]);
